# Code Replacer (для VS Code)

**Code Replacer** — это расширение для Visual Studio Code, предоставляющее интерфейс для поиска и замены многострочных фрагментов кода в активном текстовом редакторе.


## Возможности

*   **Интерфейс в боковой панели:** Удобный доступ к функциям поиска и замены.
*   **Подсветка в реальном времени (на основе AST):** Введенный для поиска код (первый стейтмент) структурно сравнивается с кодом в активном редакторе, и совпадения подсвечиваются.
*   **Замена первого вхождения:** Замена первого найденного фрагмента кода (текущая реализация замены использует строковый поиск).
*   **Автоматическое сохранение:** Файл сохраняется после успешной замены.

## Установка

### Из Marketplace (если опубликовано)
1.  Откройте Visual Studio Code.
2.  Перейдите в раздел **Расширения** (View -> Extensions или `Ctrl+Shift+X`).
3.  Найдите "Code Replacer TS" (или актуальное имя расширения).
4.  Нажмите кнопку **Install**.

### Установка из файла `.vsix` (локальная сборка)
1.  Соберите `.vsix` файл (см. раздел "Сборка расширения").
2.  В VS Code откройте палитру команд (`Ctrl+Shift+P` или `Cmd+Shift+P`).
3.  Введите и выберите `Extensions: Install from VSIX...`.
4.  Укажите путь к сгенерированному `.vsix` файлу.

## Использование

1.  **Откройте панель Code Replacer:**
    *   Найдите иконку расширения "Code Replacer" (обычно иконка `$(replace-all)`) на Activity Bar (левая боковая панель VS Code).
    *   Кликните по иконке, чтобы открыть панель.

2.  **Работа с панелью:**
    *   **Поле "Код для поиска":** Вставьте или введите фрагмент кода для поиска. По мере ввода, структурно совпадающие участки (на основе первого стейтмента введенного кода) в активном редакторе будут подсвечиваться.
    *   **Поле "Код для замены":** Вставьте или введите код, на который нужно заменить найденный фрагмент.
    *   **Кнопка "Применить":** Заменяет первое найденное вхождение (текущая замена строковая) и сохраняет файл.

## Для разработчиков

### Создание подобного проекта с нуля

Это расширение создано с использованием TypeScript. Для создания нового проекта расширения VS Code можно использовать генератор `yo code`:

1.  Установите Yeoman и генератор кода VS Code (если не установлены):
    ```bash
    npm install -g yo generator-code
    ```
2.  Запустите генератор:
    ```bash
    yo code
    ```
3.  Следуйте инструкциям, выбрав:
    *   `New Extension (TypeScript)`
    *   Придумайте имя, идентификатор и описание.
    *   Webpack: `No` (для упрощения на начальном этапе).
    *   Пакетный менеджер: `npm` или `yarn`.

### Структура проекта (примерная)

*   `src/extension.ts`: Основной файл с логикой расширения.
*   `media/`: Папка для статических ресурсов Webview (CSS, JavaScript для Webview).
    *   `webview.css`: Стили для Webview.
    *   `webview.js`: JavaScript для взаимодействия с Webview.
*   `package.json`: Манифест расширения, зависимости, скрипты.
*   `tsconfig.json`: Конфигурация компилятора TypeScript.
*   `.vscode/`: Папка с настройками запуска и задач для VS Code (`launch.json`, `tasks.json`).
*   `images/`: (Опционально) Для иконок и скриншотов.

### Запуск в режиме отладки

1.  Откройте папку проекта в VS Code.
2.  Убедитесь, что установлены все зависимости:
    ```bash
    npm install 
    ```
3.  Запустите компиляцию TypeScript в режиме отслеживания (watch mode) в одном терминале:
    ```bash
    npm run watch
    ```
4.  В VS Code нажмите `F5` (или перейдите в "Run and Debug" и запустите конфигурацию "Run Extension").
    *   Это откроет новое окно VS Code (Extension Development Host), в котором расширение будет активно.
    *   Логи расширения можно посмотреть в консоли разработчика этого нового окна (`Developer: Toggle Developer Tools`).

### Сборка `.vsix` файла для распространения

Для сборки установочного `.vsix` файла используется утилита `vsce`.

1.  Установите `vsce` глобально (если не установлен):
    ```bash
    npm install -g vsce
    ```
2.  Убедитесь, что файл `package.json` содержит необходимые поля (`name`, `version`, `publisher`, `description`, `engines.vscode` и т.д.). Для поля `publisher` потребуется имя издателя, зарегистрированное в Azure DevOps для публикации в Marketplace. Для локальной сборки можно использовать любое значение.
3.  Создайте файл `.vscodeignore` в корне проекта, чтобы исключить ненужные файлы (например, `node_modules/`, `src/`, `.git/`) из пакета. Пример:
    ```
    .vscode/**
    node_modules/**
    src/**
    *.tsbuildinfo
    .gitignore
    ```
4.  Скомпилируйте TypeScript:
    ```bash
    npm run compile
    ```
5.  Соберите пакет:
    ```bash
    vsce package
    ```
    Эта команда создаст файл вида `имя-расширения-версия.vsix` в корне проекта.

### Важные файлы и их роли (в контексте данного расширения)

*   **`package.json`**:
    *   `activationEvents`: Установлено на `"onView:codereplacer.view"` для активации при открытии боковой панели.
    *   `contributes.viewsContainers` и `contributes.views`: Определяют иконку в Activity Bar и саму Webview-панель.
    *   `main`: Указывает на скомпилированный `./out/extension.js`.
*   **`src/extension.ts`**:
    *   Функция `activate`: Регистрирует `CodeReplacerViewProvider`.
    *   Класс `CodeReplacerViewProvider`: Реализует `vscode.WebviewViewProvider` для управления содержимым и логикой Webview в боковой панели.
        *   `resolveWebviewView()`: Создает и настраивает Webview, загружает HTML.
        *   `_getHtmlForWebview()`: Генерирует HTML для Webview.
        *   Обработчик `onDidReceiveMessage`: Принимает сообщения от JavaScript Webview.
        *   `highlightTextInEditor()`: Основная логика поиска и подсветки на основе AST.
        *   `areNodesBasicallyEqual()`: Функция для структурного сравнения AST-узлов.
        *   `replaceTextInEditor_WithStringLogic()`: Текущая (строковая) логика замены.
*   **`media/webview.js`**: JavaScript, работающий внутри Webview, отправляет сообщения (`postMessage`) в расширение при вводе текста или нажатии кнопок.
*   **`media/webview.css`**: Стили для интерфейса Webview.

## Лицензия

[MIT] 

